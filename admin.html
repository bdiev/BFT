<!DOCTYPE html>
<html lang="ru">
<head>
	<meta charset="UTF-8" />
	<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0" />
	<meta name="color-scheme" content="dark" />
	<meta name="theme-color" content="#0f1116" />
	<meta name="robots" content="noindex, nofollow" />
	<title>–ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å - Sport Notepad</title>
	<link rel="icon" type="image/png" href="./icons/tabicon.png" />
	<link rel="preconnect" href="https://fonts.googleapis.com" />
	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
	<link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@400;500;600;700&display=swap" rel="stylesheet" />
	<link rel="stylesheet" href="./admin-style.css" />
</head>
<body class="theme-glass-admin">
	<div class="admin-container">
		<!-- –•–µ–¥–µ—Ä -->
		<header class="admin-header">
			<div class="header-content">
				<div class="header-left">
					<h1>‚öôÔ∏è –ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å</h1>
					<span class="admin-badge">–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä</span>
				</div>
				<div class="header-right">
					<span id="currentAdminName" class="current-user"></span>
					<a href="/" class="btn-back">‚Üê –ù–∞ –≥–ª–∞–≤–Ω—É—é</a>
					<button id="logoutBtn" class="btn-logout">–í—ã–π—Ç–∏</button>
				</div>
			</div>
		</header>

		<!-- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ -->
		<section class="stats-section">
			<div class="stat-card">
				<div class="stat-icon">üë•</div>
				<div class="stat-content">
					<div class="stat-label">–í—Å–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π</div>
					<div class="stat-value" id="totalUsers">0</div>
				</div>
			</div>
			<div class="stat-card">
				<div class="stat-icon">üîê</div>
				<div class="stat-content">
					<div class="stat-label">–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–≤</div>
					<div class="stat-value" id="adminCount">0</div>
				</div>
			</div>
			<div class="stat-card">
				<div class="stat-icon">üìä</div>
				<div class="stat-content">
					<div class="stat-label">–í—Å–µ–≥–æ –∑–∞–ø–∏—Å–µ–π</div>
					<div class="stat-value" id="totalEntries">0</div>
				</div>
			</div>
			<div class="stat-card">
				<div class="stat-icon">üíß</div>
				<div class="stat-content">
					<div class="stat-label">–õ–æ–≥–æ–≤ –≤–æ–¥—ã</div>
					<div class="stat-value" id="totalWaterLogs">0</div>
				</div>
			</div>
			<div class="stat-card">
				<div class="stat-icon">‚öñÔ∏è</div>
				<div class="stat-content">
					<div class="stat-label">–õ–æ–≥–æ–≤ –≤–µ—Å–∞</div>
					<div class="stat-value" id="totalWeightLogs">0</div>
				</div>
			</div>
			<div class="stat-card">
				<div class="stat-icon">üëÅÔ∏è</div>
				<div class="stat-content">
					<div class="stat-label">–í—Å–µ–≥–æ –ø–æ—Å–µ—â–µ–Ω–∏–π</div>
					<div class="stat-value" id="totalVisits">0</div>
				</div>
			</div>
			<div class="stat-card">
				<div class="stat-icon">üìç</div>
				<div class="stat-content">
					<div class="stat-label">–ü–æ—Å–µ—â–µ–Ω–∏–π (–∑–∞—Ä–µ–≥.)</div>
					<div class="stat-value" id="registeredVisits">0</div>
				</div>
			</div>
			<div class="stat-card">
				<div class="stat-icon">üïµÔ∏è</div>
				<div class="stat-content">
					<div class="stat-label">–ü–æ—Å–µ—â–µ–Ω–∏–π (–∞–Ω–æ–Ω.)</div>
					<div class="stat-value" id="anonymousVisits">0</div>
				</div>
			</div>
		</section>

		<!-- –¢–∞–±–ª–∏—Ü–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π -->
		<section class="users-section">
			<div class="section-header">
				<h2>–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏</h2>
				<input type="text" id="searchUsers" class="search-input" placeholder="üîç –ü–æ–∏—Å–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π...">
			</div>
			
			<div class="table-container">
				<table class="users-table" id="usersTableDesktop">
					<thead>
						<tr>
							<th class="sortable" data-sort="id">ID</th>
							<th class="sortable" data-sort="username">–õ–æ–≥–∏–Ω</th>
							<th class="sortable" data-sort="gender">–ü–æ–ª</th>
							<th>Email</th>
							<th class="sortable" data-sort="created_at">–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è</th>
					<th class="sortable" data-sort="total_logs">–í—Å–µ–≥–æ –ª–æ–≥–æ–≤</th>
							<th class="sortable" data-sort="is_admin">–†–æ–ª—å</th>
							<th>–î–µ–π—Å—Ç–≤–∏—è</th>
						</tr>
					</thead>
					<tbody id="usersTableBody">
						<!-- –ó–∞–ø–æ–ª–Ω—è–µ—Ç—Å—è JS -->
					</tbody>
				</table>
			</div>
			
			<!-- –ú–æ–±–∏–ª—å–Ω–æ–µ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏–µ -->
			<div class="users-grid" id="usersGridMobile">
				<!-- –ó–∞–ø–æ–ª–Ω—è–µ—Ç—Å—è JS –Ω–∞ –º–æ–±–∏–ª—å–Ω—ã—Ö -->
			</div>
		</section>

		<!-- –ü–æ–¥–¥–µ—Ä–∂–∫–∞ -->
		<section class="tickets-section">
			<div class="section-header">
				<h2>–ß–∞—Ç –ø–æ–¥–¥–µ—Ä–∂–∫–∏</h2>
				<div class="tickets-filters">
					<div class="toggle-group">
						<button class="toggle-btn active" data-value="active" data-filter="archive">–ê–∫—Ç–∏–≤–Ω—ã–µ</button>
						<button class="toggle-btn" data-value="archived" data-filter="archive">–ê—Ä—Ö–∏–≤</button>
					</div>
					<div class="toggle-group">
						<button class="toggle-btn active" data-value="all" data-filter="status">–í—Å–µ</button>
						<button class="toggle-btn" data-value="open" data-filter="status">–û—Ç–∫—Ä—ã—Ç</button>
						<button class="toggle-btn" data-value="in_progress" data-filter="status">–í —Ä–∞–±–æ—Ç–µ</button>
						<button class="toggle-btn" data-value="resolved" data-filter="status">–ò—Å–ø—Ä–∞–≤–ª–µ–Ω</button>
						<button class="toggle-btn" data-value="closed" data-filter="status">–ó–∞–∫—Ä—ã—Ç</button>
					</div>
				</div>
			</div>

			<div class="tickets-grid">
				<div class="tickets-list" id="ticketsList">
					<div class="empty-state">–¢–∏–∫–µ—Ç–æ–≤ –ø–æ–∫–∞ –Ω–µ—Ç</div>
				</div>
				<div class="ticket-thread" id="ticketThread">
					<div class="ticket-thread__header">
						<div>
							<div id="ticketSubject" class="ticket-subject">–í—ã–±–µ—Ä–∏—Ç–µ —Ç–∏–∫–µ—Ç</div>
							<div id="ticketMeta" class="ticket-meta"></div>
						</div>
						<div class="ticket-status-controls">
							<select id="ticketStatusSelect" class="search-input" style="max-width: 180px;">
								<option value="open">–û—Ç–∫—Ä—ã—Ç</option>
								<option value="in_progress">–í —Ä–∞–±–æ—Ç–µ</option>
								<option value="resolved">–ò—Å–ø—Ä–∞–≤–ª–µ–Ω</option>
								<option value="closed">–ó–∞–∫—Ä—ã—Ç</option>
							</select>
							<button class="btn-primary" id="saveTicketStatusBtn">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
							<button class="btn-secondary" id="archiveTicketBtn" title="–ê—Ä—Ö–∏–≤–∏—Ä–æ–≤–∞—Ç—å —Ç–∏–∫–µ—Ç">üì¶ –ê—Ä—Ö–∏–≤</button>
						</div>
					</div>
					<div id="ticketTypingIndicator" class="typing-indicator" aria-live="polite" aria-atomic="true">
						<div class="typing-dots" aria-hidden="true">
							<span class="typing-dot"></span>
							<span class="typing-dot"></span>
							<span class="typing-dot"></span>
						</div>
						<span id="ticketTypingText" class="typing-text">–ö–ª–∏–µ–Ω—Ç –ø–µ—á–∞—Ç–∞–µ—Ç...</span>
					</div>
					<div class="ticket-messages" id="ticketMessages">
						<div class="empty-state">–ù–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏–π</div>
					</div>
					<div class="ticket-reply">
						<textarea id="ticketReplyInput" placeholder="–û—Ç–≤–µ—Ç–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é"></textarea>
						<button class="btn-primary" id="sendTicketReplyBtn">–û—Ç–ø—Ä–∞–≤–∏—Ç—å</button>
					</div>
				</div>
			</div>
		</section>

		<!-- –ù–µ–¥–∞–≤–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ -->
		<section class="recent-users-section">
			<h3>–ù–µ–¥–∞–≤–Ω–∏–µ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏</h3>
			<div id="recentUsersList" class="recent-users-list">
				<!-- –ó–∞–ø–æ–ª–Ω—è–µ—Ç—Å—è JS -->
			</div>
		</section>
	</div>

	<!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–ª—è –¥–µ—Ç–∞–ª–µ–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è -->
	<div class="modal-overlay" id="userDetailsModal" style="display: none;">
		<div class="modal-content">
			<div class="modal-header">
				<h2>–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ</h2>
				<button class="modal-close" id="closeUserDetailsModal">‚úï</button>
			</div>
			<div class="modal-body" id="userDetailsContent">
				<!-- –ó–∞–ø–æ–ª–Ω—è–µ—Ç—Å—è JS -->
			</div>
		</div>
	</div>

	<!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–ª—è —Å–±—Ä–æ—Å–∞ –ø–∞—Ä–æ–ª—è -->
	<div class="modal-overlay" id="resetPasswordModal" style="display: none;">
		<div class="modal-content">
			<div class="modal-header">
				<h2>–°–±—Ä–æ—Å –ø–∞—Ä–æ–ª—è</h2>
				<button class="modal-close" id="closeResetPasswordModal">‚úï</button>
			</div>
			<div class="modal-body">
				<p>–°–±—Ä–æ—Å –ø–∞—Ä–æ–ª—è –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è: <strong id="resetPasswordUsername"></strong></p>
				<div style="margin-top: 16px;">
					<label for="newPasswordInput" class="label">–ù–æ–≤—ã–π –ø–∞—Ä–æ–ª—å</label>
					<input type="password" id="newPasswordInput" placeholder="–ú–∏–Ω–∏–º—É–º 4 —Å–∏–º–≤–æ–ª–∞" />
				</div>
				<div style="margin-top: 20px; display: flex; gap: 12px;">
					<button id="confirmResetPasswordBtn" class="btn-primary">–°–±—Ä–æ—Å–∏—Ç—å –ø–∞—Ä–æ–ª—å</button>
					<button id="cancelResetPasswordBtn" class="btn-secondary">–û—Ç–º–µ–Ω–∞</button>
				</div>
			</div>
		</div>
	</div>

	<script src="./admin.js"></script>
	
	<!-- –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤–∏–∑–∏—Ç–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª–∏ -->
	<script>
		// –õ–æ–≥–∏—Ä—É–µ–º –≤–∏–∑–∏—Ç –∫–∞–∫ –º–æ–∂–Ω–æ —Ä–∞–Ω—å—à–µ (–¥–∞–∂–µ –µ—Å–ª–∏ admin.js –µ—â—ë –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è)
		if (navigator.sendBeacon) {
			// –ò—Å–ø–æ–ª—å–∑—É–µ–º sendBeacon –¥–ª—è –≥–∞—Ä–∞–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω–æ–π –¥–æ—Å—Ç–∞–≤–∫–∏ –¥–∞–∂–µ –ø—Ä–∏ –≤—ã–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
			navigator.sendBeacon('/api/log-visit');
		} else {
			// Fallback –¥–ª—è —Å—Ç–∞—Ä—ã—Ö –±—Ä–∞—É–∑–µ—Ä–æ–≤
			fetch('/api/log-visit', { method: 'POST', credentials: 'include' }).catch(() => {});
		}
		console.log('üìç –í–∏–∑–∏—Ç –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞ –∑–∞–ª–æ–≥–∏—Ä–æ–≤–∞–Ω –Ω–∞ —Å–µ—Ä–≤–µ—Ä');
	</script>
</body>
</html>
